{"version":3,"sources":["PuzzleBoardRenderer.js"],"names":["require","cc","Class","extends","Component","properties","boardWidth","boardHeight","poemDefinition","default","type","PoemDefinition","puzzleDefinition","PuzzleDefinition","stageDefinition","StageDefinition","anchorStartPoint","v2","anchorInterval","puzzleBoardPrefab","Prefab","boardProvider","PuzzleBoardProvider","boardRootNode","Node","init","console","log","self","createBoard","onLoad","size","getBoardSize","i","x","j","y","characterId","getCharacterAt","GlobalStorage","loadCharacterSpriteFrame","characterSpriteFrame","ii","jj","node","charSprite","addComponent","Sprite","spriteFrame","posX","posY","position","scale","puzzleNode","PuzzleNodeRenderer","callbackNode","callbackComponentName","callbackHandlerName","addChild","start","onBoardClickedAt","event","customEventData","target","takeActionAt","onChooseCharacterAt","onUnchooseCharacterAt","firstPosition","onMatchNotConnected","onConnected","connectPoints"],"mappings":"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","file":"PuzzleBoardRenderer.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Scripts\\UI\\Controls","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nrequire('GlobalStorage');\r\n\r\nrequire('PoemDefinition');\r\nrequire('StageDefinition');\r\nrequire('PuzzleDefinition');\r\nrequire('PuzzleBoardProvider');\r\n\r\nrequire('PuzzleNodeRenderer');\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        \r\n        boardWidth: 1,\r\n        \r\n        boardHeight: 1,\r\n        \r\n        poemDefinition: {\r\n            default: null,\r\n            type: cc.PoemDefinition,\r\n        },\r\n        \r\n        puzzleDefinition: {\r\n            default: null,\r\n            type: cc.PuzzleDefinition,\r\n        },\r\n        \r\n        stageDefinition: {\r\n            default: null,\r\n            type: cc.StageDefinition,\r\n        },\r\n        \r\n        anchorStartPoint: {\r\n            default: cc.v2(0, 0),\r\n            type: cc.v2\r\n        },\r\n        \r\n        anchorInterval: 64,\r\n        \r\n        puzzleBoardPrefab: cc.Prefab,\r\n        \r\n        boardProvider: {\r\n            default: null,\r\n            type: cc.PuzzleBoardProvider,\r\n        },\r\n        \r\n        boardRootNode: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        \r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    init: function(stageDefinition) {\r\n    \r\n        console.log('PuzzleBoard init.');\r\n        \r\n        this.stageDefinition = stageDefinition;\r\n        this.poemDefinition = this.stageDefinition.poemDefinition;\r\n        this.puzzleDefinition = this.stageDefinition.puzzleDefinition;\r\n        \r\n        if (!this.poemDefinition || !this.puzzleDefinition) {\r\n        \r\n            console.log('poemDefinition is null.');\r\n            return;\r\n        }\r\n        \r\n        var self = this;\r\n        \r\n        this.boardProvider = new cc.PuzzleBoardProvider();\r\n        this.boardProvider.createBoard(this.stageDefinition);\r\n        \r\n    },\r\n\r\n\r\n    onLoad () {\r\n        \r\n        var self = this;\r\n        \r\n        var size = this.boardProvider.getBoardSize();\r\n        for (var i = 1; i <= size.x; ++i) {\r\n            for (var j = 1; j <= size.y; ++j) {\r\n        \r\n                var characterId = this.boardProvider.getCharacterAt(i, j);\r\n                \r\n                if (characterId) {\r\n                    \r\n                    console.log('got character: ', i, j, characterId);\r\n                    cc.GlobalStorage.loadCharacterSpriteFrame(characterId, i, j, function(characterSpriteFrame, ii, jj) {\r\n        \r\n                        var node = new cc.Node();\r\n                        let charSprite = node.addComponent(cc.Sprite);\r\n                        charSprite.spriteFrame = characterSpriteFrame;\r\n                        \r\n                        var posX = self.anchorStartPoint.x + ii * self.anchorInterval;\r\n                        var posY = self.anchorStartPoint.y - jj * self.anchorInterval;\r\n                        \r\n                        //var posX = -160 + ii * 64;\r\n                        //var posY = 226 - jj * 64;\r\n                        \r\n                        node.position = cc.v2(posX, posY);\r\n                        node.scale = 0.5;\r\n                        // node.tag = cc.v2(ii, jj);\r\n                        // node.on(cc.Node.EventType.TOUCH_END, this.onBoardClickedAt, this);\r\n                        \r\n                        \r\n                        // var clickEventHandler = new cc.Component.EventHandler();\r\n                        // clickEventHandler.target = self.node; //这个 node 节点是你的事件处理代码组件所属的节点，这里就是Button2\r\n                        // clickEventHandler.component = \"PuzzleBoardRenderer\";//这个是脚本文件名\r\n                        // clickEventHandler.handler = \"onBoardClickedAt\"; //回调函名称\r\n                        // clickEventHandler.customEventData = cc.v2(ii, jj); //用户数据\r\n                        // \r\n                        // let button = node.addComponent(cc.Button); //获取cc.Button组件\r\n                        // button.clickEvents.push(clickEventHandler);\r\n                        \r\n                        let puzzleNode = node.addComponent(cc.PuzzleNodeRenderer);\r\n                        puzzleNode.position = cc.v2(ii, jj);\r\n                        puzzleNode.callbackNode = self.node;\r\n                        puzzleNode.callbackComponentName = \"PuzzleBoardRenderer\";\r\n                        puzzleNode.callbackHandlerName = \"onBoardClickedAt\";\r\n                        \r\n                        self.boardRootNode.addChild(node);\r\n                    });\r\n                }\r\n            }\r\n        }\r\n        \r\n    },\r\n    \r\n    start () {\r\n\r\n    },\r\n\r\n    onBoardClickedAt: function (event, customEventData) {\r\n        \r\n        console.log('onBoardClickedAt');\r\n        \r\n        var node = event.target;\r\n        if (!node || !customEventData) {\r\n            console.log(\"onBoardClickedAt: empty event data detected.\");\r\n            return;\r\n        }\r\n        \r\n        var position = customEventData;\r\n        \r\n        this.boardProvider.takeActionAt(position);\r\n    },\r\n\r\n    // --------------- Callbacks from Provider ---------------\r\n    onChooseCharacterAt: function (position) {\r\n    \r\n    },\r\n    \r\n    // The two characters not match, or use click the firstPosition again. Cancel them.\r\n    onUnchooseCharacterAt: function (position, firstPosition) {\r\n    \r\n    },\r\n    \r\n    // The two characters are matching, but not connected, so cancel them\r\n    onMatchNotConnected: function (position, firstPosition) {\r\n    \r\n    },\r\n\r\n    // Connect from the firstPosition through connectPoints and to the position\r\n    onConnected: function (position, firstPosition, connectPoints) {\r\n    \r\n    },\r\n\r\n\r\n    // update (dt) {},\r\n});\r\n"]}