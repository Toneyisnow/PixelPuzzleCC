{"version":3,"sources":["../../../../../assets/Scripts/Components/assets/Scripts/Components/StageDefinition.js"],"names":["require","StageDefinition","stageId","poemDefinition","undefined","puzzleDefinition","formulaDefinitions","targetCharaters","targetCharacterId","i","length","targetCharacter","characterA","characterB","sourceCharacterA","sourceCharacterB","callback","caller","console","log","resouceUrl","cc","loader","loadRes","JsonAsset","err","result","stage","loadFromJsonText","json","jsonObject","PoemDefinition","poem","PuzzleDefinition","puzzle","formula","forEach","itemArr","index","FormulaDefinition","loadFromArray","push"],"mappings":";;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEAA,QAAQ,gBAAR;AACAA,QAAQ,kBAAR;AACAA,QAAQ,mBAAR;;IAGMC;AAEF,+BAAc;AAAA;;AAEV,aAAKC,OAAL,GAAe,CAAf;;AAEA,aAAKC,cAAL,GAAsBC,SAAtB;;AAEA,aAAKC,gBAAL,GAAwBD,SAAxB;;AAEA,aAAKE,kBAAL,GAA0B,EAA1B;;AAEA,aAAKC,eAAL,GAAuB,EAAvB;AACH;;AAED;;;;;8CA4CsBC,mBAAmB;;AAErC,iBAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAI,KAAKH,kBAAL,CAAwBI,MAA5C,EAAoDD,GAApD,EAAyD;;AAErD,oBAAI,KAAKH,kBAAL,CAAwBG,CAAxB,EAA2BE,eAA3B,IAA8CH,iBAAlD,EAAqE;AACjE,2BAAO,KAAKF,kBAAL,CAAwBG,CAAxB,CAAP;AACH;AACJ;;AAED,mBAAOL,SAAP;AACH;;;+CAEsBQ,YAAYC,YAAY;;AAE3C,iBAAK,IAAIJ,IAAI,CAAb,EAAgBA,IAAI,KAAKH,kBAAL,CAAwBI,MAA5C,EAAoDD,GAApD,EAAyD;;AAErD,oBAAI,KAAKH,kBAAL,CAAwBG,CAAxB,EAA2BK,gBAA3B,IAA+CF,UAA/C,IAA6D,KAAKN,kBAAL,CAAwBG,CAAxB,EAA2BM,gBAA3B,IAA+CF,UAA5G,IACD,KAAKP,kBAAL,CAAwBG,CAAxB,EAA2BM,gBAA3B,IAA+CH,UAA/C,IAA6D,KAAKN,kBAAL,CAAwBG,CAAxB,EAA2BK,gBAA3B,IAA+CD,UAD/G,EAC2H;AACvH,2BAAO,KAAKP,kBAAL,CAAwBG,CAAxB,CAAP;AACH;AACJ;;AAED,mBAAOL,SAAP;AACH;;;kDAEyB,CAGzB;;;qCAvEmBF,SAASc,UAAUC,QAAQ;;AAE3CC,oBAAQC,GAAR,CAAY,eAAZ,EAA6B,kBAAkBjB,OAA/C;;AAEA,gBAAIkB,aAAa,kBAAkBlB,OAAnC;AACAmB,eAAGC,MAAH,CAAUC,OAAV,CAAkBH,UAAlB,EAA8BC,GAAGG,SAAjC,EAA4C,UAAUC,GAAV,EAAeC,MAAf,EAC5C;AACI,oBAAID,GAAJ,EAAS;;AAELP,4BAAQC,GAAR,CAAY,sCAAZ,EAAoDM,GAApD;AAEH,iBAJD,MAIO;;AAEH,wBAAIE,QAAQ1B,gBAAgB2B,gBAAhB,CAAiCF,OAAOG,IAAxC,CAAZ;AACAF,0BAAMzB,OAAN,GAAgBA,OAAhB;;AAEAc,6BAASC,MAAT,EAAiBU,KAAjB;AACH;;AAED;;AAEA;AACA;AACH,aAlBD;AAmBH;;;yCAEuBG,YAAY;;AAEhC,gBAAIH,QAAQ,IAAIN,GAAGpB,eAAP,EAAZ;AACA0B,kBAAMxB,cAAN,GAAuBkB,GAAGU,cAAH,CAAkBH,gBAAlB,CAAmCE,WAAWE,IAA9C,CAAvB;AACAL,kBAAMtB,gBAAN,GAAyBgB,GAAGY,gBAAH,CAAoBL,gBAApB,CAAqCE,WAAWI,MAAhD,CAAzB;;AAEA,gBAAIJ,WAAWK,OAAf,EAAwB;AACpBL,2BAAWK,OAAX,CAAmBC,OAAnB,CAA2B,UAAUC,OAAV,EAAmBC,KAAnB,EAA0B;;AAEjD,wBAAIH,UAAUd,GAAGkB,iBAAH,CAAqBC,aAArB,CAAmCH,OAAnC,CAAd;AACAV,0BAAMrB,kBAAN,CAAyBmC,IAAzB,CAA8BN,OAA9B;AACH,iBAJD;AAKH;;AAED,mBAAOR,KAAP;AACH;;;;;;AA+BJ;;AAIDN,GAAGpB,eAAH,GAAqBA,eAArB","file":"StageDefinition.js","sourceRoot":"../../../../../assets/Scripts/Components","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nrequire('PoemDefinition');\r\nrequire('PuzzleDefinition');\r\nrequire('FormulaDefinition');\r\n\r\n\r\nclass StageDefinition {\r\n\r\n    constructor() {\r\n\r\n        this.stageId = 0;\r\n\r\n        this.poemDefinition = undefined;\r\n\r\n        this.puzzleDefinition = undefined;\r\n\r\n        this.formulaDefinitions = [];\r\n\r\n        this.targetCharaters = [];\r\n    }\r\n\r\n    // Load definition from JSON file\r\n    static loadFromFile(stageId, callback, caller) {\r\n\r\n        console.log('loadFromJson:', 'stages/stage_' + stageId);\r\n\r\n        var resouceUrl = 'stages/stage_' + stageId;\r\n        cc.loader.loadRes(resouceUrl, cc.JsonAsset, function( err, result)\r\n        {\r\n            if (err) {\r\n\r\n                console.log('StageDefinition.loadFromFile Error: ', err);\r\n\r\n            } else {\r\n\r\n                let stage = StageDefinition.loadFromJsonText(result.json);\r\n                stage.stageId = stageId;\r\n\r\n                callback(caller, stage);\r\n            }\r\n\r\n            //Object.assign(target, result.json);\r\n\r\n            //console.log('load result poem: ' + JSON.stringify(target.poem));\r\n            //console.log('load result json poem: ' + JSON.stringify(result.json.poem));\r\n        });\r\n    }\r\n\r\n    static loadFromJsonText(jsonObject) {\r\n\r\n        var stage = new cc.StageDefinition();\r\n        stage.poemDefinition = cc.PoemDefinition.loadFromJsonText(jsonObject.poem);\r\n        stage.puzzleDefinition = cc.PuzzleDefinition.loadFromJsonText(jsonObject.puzzle);\r\n\r\n        if (jsonObject.formula) {\r\n            jsonObject.formula.forEach(function (itemArr, index) {\r\n\r\n                var formula = cc.FormulaDefinition.loadFromArray(itemArr);\r\n                stage.formulaDefinitions.push(formula);\r\n            });\r\n        }\r\n\r\n        return stage;\r\n    }\r\n\r\n    findFormulaDefinition(targetCharacterId) {\r\n\r\n        for (var i = 0; i < this.formulaDefinitions.length; i++) {\r\n\r\n            if (this.formulaDefinitions[i].targetCharacter == targetCharacterId) {\r\n                return this.formulaDefinitions[i];\r\n            }\r\n        }\r\n\r\n        return undefined;\r\n    }\r\n\r\n    matchFormulaDefinition(characterA, characterB) {\r\n\r\n        for (var i = 0; i < this.formulaDefinitions.length; i++) {\r\n\r\n            if (this.formulaDefinitions[i].sourceCharacterA == characterA && this.formulaDefinitions[i].sourceCharacterB == characterB\r\n            || this.formulaDefinitions[i].sourceCharacterB == characterA && this.formulaDefinitions[i].sourceCharacterA == characterB) {\r\n                return this.formulaDefinitions[i];\r\n            }\r\n        }\r\n\r\n        return undefined;\r\n    }\r\n\r\n    collectTargetCharacters() {\r\n\r\n      \r\n    }\r\n};\r\n\r\n\r\n\r\ncc.StageDefinition = StageDefinition;\r\n"]}