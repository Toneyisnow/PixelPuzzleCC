{"version":3,"sources":["../../../../../assets/Scripts/UI/assets/Scripts/UI/SelectStageScene.js"],"names":["require","cc","Class","extends","Component","properties","categoryTitle","default","type","Node","titleTransitionDuration","fadeInDuration","stagePreviewAnchors","stagePreviewPrefab","Prefab","stagePreviewNodes","btnBack","categoryId","onLoad","GlobalStorage","loadIntermediateValue","createStagePreviews","on","onBackClicked","start","moveTitleAction","targetedAction","moveTo","actions","i","targetedx","fadeIn","push","seq","sequence","spawn","node","runAction","stageId","record","StageRecord","previewNode","instantiate","anchor","addChild","position","v2","opacity","onPreviewNodeSelected","previewRenderer","getComponent","init","console","log","saveIntermediateValue","director","loadScene","event"],"mappings":"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","file":"SelectStageScene.js","sourceRoot":"../../../../../assets/Scripts/UI","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nrequire('GlobalStorage');\r\nrequire('StageRecord');\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    \r\n    properties: {\r\n        \r\n        categoryTitle: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        \r\n        titleTransitionDuration: 1.0,\r\n        fadeInDuration: 1.5,\r\n        \r\n        stagePreviewAnchors: {\r\n            default: [],\r\n            type: cc.Node\r\n        },\r\n        \r\n        \r\n        stagePreviewPrefab: cc.Prefab,\r\n        \r\n        stagePreviewNodes: [],\r\n        \r\n        btnBack: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        \r\n        categoryId: 0,\r\n        \r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        \r\n        this.categoryId = cc.GlobalStorage.loadIntermediateValue(\"selectedCategoryId\");\r\n        \r\n        \r\n        this.createStagePreviews();\r\n        this.btnBack.on('touchup', this.onBackClicked);\r\n    },\r\n\r\n    start () {\r\n    \r\n        var moveTitleAction = cc.targetedAction(this.categoryTitle, cc.moveTo(this.titleTransitionDuration, 0, 350));\r\n        \r\n        var actions = [];\r\n        for (var i = 0; i < 9; ++i) {\r\n            var targetedx = cc.targetedAction(this.stagePreviewNodes[i], cc.fadeIn(this.fadeInDuration));\r\n            actions.push(targetedx);\r\n        }\r\n        \r\n        var seq = cc.sequence(moveTitleAction, cc.spawn(actions));\r\n        \r\n        this.node.runAction(seq);\r\n        \r\n    },\r\n\r\n    createStagePreviews: function () {\r\n        \r\n        for (var i = 0; i < 9; ++i) {\r\n            \r\n            // Read definition and record\r\n            var stageId = this.categoryId * 100 + i + 1;\r\n            var record = new cc.StageRecord();\r\n            record.stageId = stageId;\r\n            \r\n            \r\n            var previewNode = cc.instantiate(this.stagePreviewPrefab);\r\n            if (!previewNode) {\r\n                continue;\r\n            }\r\n            \r\n            var anchor = this.stagePreviewAnchors[i];\r\n            if (!anchor) {\r\n                continue;\r\n            }\r\n            \r\n            anchor.addChild(previewNode);\r\n            previewNode.position = cc.v2(0, 0);\r\n            previewNode.opacity = 0;\r\n            \r\n            previewNode.on(\"onSelected\", this.onPreviewNodeSelected, this);\r\n            \r\n            var previewRenderer = previewNode.getComponent('StagePreviewRenderer');\r\n            previewRenderer.init(stageId, record);\r\n            \r\n            this.stagePreviewNodes.push(previewNode);\r\n            \r\n            console.log('Created Stage Preview.');\r\n        }\r\n    },\r\n\r\n    onPreviewNodeSelected: function(stageId) {\r\n        \r\n        console.log('onPreviewNodeSelected: ', stageId);\r\n        \r\n        cc.GlobalStorage.saveIntermediateValue(\"selectedStageId\", stageId);\r\n        cc.director.loadScene(\"MainGameScene\");\r\n    },\r\n\r\n    onBackClicked: function (event) {\r\n    \r\n        console.log('onBackClicked triggered.');\r\n        \r\n        cc.director.loadScene(\"SelectCategoryScene\");\r\n    },\r\n\r\n    // update (dt) {},\r\n});\r\n"]}